<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.mapper.RateMapper">
	<resultMap type="com.app.entity.Rate" id="RaterResultMap">
		<id column="ID" property="rateId"></id>
		<result column="RATE_PERIOD" property="ratePeriod"></result>
		<result column="RATES" property="rates"></result>
		<result column="STAG_CODE" property="stagCode"></result>
		<result column="STAG_NAME" property="stagName"></result>
		<result column="STAGING_PLAN_CODE" property="stagingPlanCode"></result>
		<result column="STAGING_PLAN_NAME" property="stagingPlanName"></result>
		<result column="STATE_CODE" property="stateCode"></result>
		<result column="STATE_NAME" property="stateNmae"></result>
		<result column="PAYTYPE_CODE" property="paytypeCode"></result>
		<result column="PAYTYPE_NAME" property="paytypeName"></result>
		<result column="CURRENCY_CODE" property="currencyCode"></result>
		<result column="CURRENCY_NAME" property="currencyName"></result>
	</resultMap>
	<sql id="ratesColumns">RATE_PERIOD,RATES,STAG_CODE,STAG_NAME,STAGING_PLAN_CODE,STAGING_PLAN_NAME,
		STATE_CODE,STATE_NAME,PAYTYPE_CODE,PAYTYPE_NAME,CURRENCY_CODE,CURRENCY_NAME
	</sql>
	<!-- 分期类型 -->
	<resultMap type="com.app.entity.StagingType" id="StagingTypeResultMap">
		<id column="ID" property="id"></id>
		<result column="STAG_CODE" property="stagCode" />
		<result column="STAG_NAME" property="stagName" />
	</resultMap>
	
	
	<!-- 状态表 -->
	<resultMap type="com.app.entity.State" id="StateResultMap">
		<id column="ID" property="stateId"></id>
		<result column="STATE_CODE" property="stateCode"></result>
		<result column="STATE_NAME" property="stateName"></result>
		<result column="STAG_CODE" property="stagCode"></result>
	</resultMap>
	<!-- 分期计划表 -->
	<resultMap type="com.app.entity.StagingPlan" id="StagingPlanResultMap">
		<id column="ID" property="planId"></id>
		<result column="STAGING_PLAN_CODE" property="stagingPlanCode"></result>
		<result column="STAGING_PLAN_NAME" property="stagingPlanName"></result>
		<result column="STATE_CODE" property="stateCode"></result>
	</resultMap>
	<!-- 支付方式表 -->
	<resultMap type="com.app.entity.Paytype" id="PaytypeResultMap">
		<id column="ID" property="paytpeId"></id>
		<result column="PAYTYPE_CODE" property="paytypeCode"></result>
		<result column="PAYTYPE_NAME" property="paytypeNmae"></result>
	</resultMap>
	<!-- 分期类型初始化数据 -->
	<select id="listStagingType" resultMap="StagingTypeResultMap">
		select STAG_CODE,STAG_NAME from bank_staging_type where 1=1
	</select>
	<!-- 分期计划初始化数据 -->
	<select id="listStagingPlan" resultMap="StagingPlanResultMap">
		select
		STAGING_PLAN_CODE,STAGING_PLAN_NAME from bank_staging_plan where 1=1
	</select>
	<!-- 状态初始化数据 -->
	<select id="listState" resultMap="StateResultMap">
		select STATE_CODE,STATE_NAME from bank_state where 1=1
	</select>
	
	
	<update id="update" parameterType="com.app.entity.Rate">
			update bank_rate a set a.RATE_PERIOD=#{ratePeriod},a.RATES=#{rates}  where  a.ID=#{rateId}
		</update>
	
	<!-- 分页查询 -->
	<select id="listPageRates" parameterType="com.app.entity.Rate"
		resultMap="RaterResultMap">
		SELECT * FROM bank_rate e WHERE 1=1
		<if test="stagCode!= null and stagCode!= ''">
			and STAG_CODE=#{stagCode}
		</if>
		<if test="stagingPlanCode!= null and stagingPlanCode!= ''">
			and STAGING_PLAN_CODE=#{stagingPlanCode}
		</if>
		<if test="stateCode!= null and stateCode!= ''">
			and STATE_CODE=#{stateCode}
		</if>
	</select>

	<!-- 查询分期类型 -->
	<select id="getStagingType" resultMap="StagingTypeResultMap">
		select STAG_CODE,STAG_NAME from bank_staging_type where 1=1
	</select>
	<!-- 查询状态 -->
	<select id="getState" parameterType="int" resultMap="StateResultMap">
		SELECT * FROM bank_state WHERE STAG_CODE=#{stagCode}
	</select>
	<!-- 查询分期计划 -->
	<select id="getStagingPlan" parameterType="int" resultMap="StagingPlanResultMap">
		SELECT * FROM bank_staging_plan WHERE STATE_CODE=#{stateCode}
	</select>
	<!-- 查询支付方式 -->
	<select id="listPaytype" resultMap="PaytypeResultMap">
		select * from
		bank_fee_paytype where 1=1
	</select>
	<insert id="insertRates" parameterType="com.app.entity.Rate"
		useGeneratedKeys="false" keyProperty="rateId">
		insert INTO bank_rate (
		<include refid="ratesColumns" />
		)
		values (#{ratePeriod},#{rates},
		#{stagCode},#{stagName},#{stagingPlanCode},#{stagingPlanName},
		#{stateCode},#{stateNmae},#{paytypeCode},#{paytypeName},#{currencyCode},
		#{currencyName})
	</insert>
	<delete id="deleteByid" parameterType="int">
		delete from bank_rate where ID=#{rateId}
	</delete>
	<!-- 删除的时候判断是此数据是否有关联 -->
	<select id="getCountCode" parameterType="Integer" resultType="Integer">
		select count(1) from bank_rate where
		STAGING_PLAN_CODE=#{stagingPlanCode}
	</select>
	
	<select id="rateById" parameterType="int" resultMap="RaterResultMap">
			select * from bank_rate where 1=1 and ID=#{rateId}
		</select>
	
</mapper>
