<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.mapper.BankPrFiledTypeMapper">
		 
	
	<select id="bankPrFiledTypePageList" resultType="BankPrFiledType" parameterType="BankPrFiledType">	
	   select 
         t.type_id as typeId,
         a.rights_type_name as typeName 
       from bank_pr_filed_type t  
       left join bank_pr_rights_type a on t.type_id=a.rights_type_code
       left join bank_pr_rights_filed b on t.filed_id=b.filed_id
       where  1=1 
		    <if test="typeId!=null and typeId!=''">
				  and  t.type_id=#{typeId,jdbcType=VARCHAR}                   
			 </if>
		 group by t.type_id,a.rights_type_name
		 order by t.type_id 
	</select>
	<select id="serviceTypeList" resultType="java.util.HashMap">
	    select
		 t.rights_type_code as value,
		 t.rights_type_name as content
		from bank_pr_rights_type t
	</select>
	<select id="selectFiledList" resultType="java.util.HashMap">
	   select 
		 t.filed_id as filedId,
		 t.filed_name as filedName,
		 t.filed_show_where as filedShowWhere,
		 t.filed_abc_name as filedAbcName,
		 t.filed_form_type as filedFormType
	   from bank_pr_rights_filed t
	   order by t.sort_no
	</select>
	<insert id="saveFiledType"  parameterType="BankPrFiledType">
	  insert into bank_pr_filed_type(
	     TYPE_ID,
	     FILED_ID,
	     FILED_NAME,
	     SORT_NO,
	     IS_SHOW,
	     FILED_ALERT,
	     MAX_LENGTH
	  )values (
	    
	    #{typeId,jdbcType=VARCHAR},
	    #{filedId,jdbcType=VARCHAR},
	    #{filedName,jdbcType=VARCHAR},
	    #{sortNo,jdbcType=NUMERIC},
	    #{isShow,jdbcType=VARCHAR},
	    #{filedAlert,jdbcType=VARCHAR},
	    #{maxLength,jdbcType=VARCHAR}  
	  )
	 
	</insert>
	<delete id="delFiledType">
	    delete from bank_pr_filed_type   
		 <where>
			 TYPE_ID  in
			<foreach collection="array" item="item" index="index" open="("
				separator="," close=")">#{item}</foreach>
		</where>
	</delete>
	<select id="selectBankPrFiledById" parameterType="String" resultType="BankPrFiledType">
	     select 
	       t.filed_type_id as filedTypeId,
	       t.type_id as typeId,
	       a.rights_type_name as typeName,
	       t.filed_id as filedId,
	       t.filed_name as filedName,
	       t.sort_no as sortNo,
		   t.filed_alert as filedAlert,
		   b.filed_show_where as showWhere,
		   b.filed_form_type as formType,
		   t.is_show as isShow,
		   t.max_length as maxLength
		from bank_pr_filed_type t  
	    left join bank_pr_rights_type a on t.type_id=a.rights_type_code 
	    left join bank_pr_rights_filed b on t.filed_id=b.filed_id
	    where  t.type_id=#{typeId,jdbcType=VARCHAR}
	    order by t.sort_no
	</select>
	<update id="updateFiledType" parameterType="BankPrFiledType">
	  update bank_pr_filed_type set
		  type_id=#{typeId,jdbcType=VARCHAR},
		  filed_id=#{filedId,jdbcType=VARCHAR},
		  sort_no=#{sortNo,jdbcType=VARCHAR},
		  filed_alert=#{filedAlert,jdbcType=VARCHAR}
	  WHERE filed_type_id=#{filedTypeId,jdbcType=VARCHAR}
	</update>
	<select id="selectExistsTypeId" parameterType="BankPrFiledType" resultType="int">
	   select count(1) from bank_pr_filed_type t 
	   where t.type_id=#{typeId,jdbcType=VARCHAR}  
	</select>
	
	<select id="selectAllFiledById" parameterType="String" resultType="java.util.HashMap">
	   select 
	     filedId,
	     filedName,
	     filedShowWhere,
	     filedAbcName,
	     filedFormType,
	     sortNo,
	     maxLength,
	     filedAlert,
	     sortNum,
	     isShow
        from ( 
		select 
		     a.filed_id as filedId,
		     a.filed_name as filedName,
		     a.filed_show_where as filedShowWhere,
		     a.filed_abc_name as filedAbcName,
		     a.filed_form_type as filedFormType,
			 a.sort_no as sortNo,
			 f.max_length as maxLength,
			 f.filed_alert as filedAlert,
			 case 
			  when f.sort_no is not null then null
			  else f.sort_no 
			 end as sortNum,
			 case 
				 when f.is_show is not null then null
				 else f.is_show 
			 end as isShow
		from bank_pr_rights_filed a
		left join bank_pr_filed_type f on a.filed_id=f.filed_id
		where a.filed_id not in (select c.filed_id from bank_pr_filed_type c where c.type_id=#{typeId,jdbcType=VARCHAR}) 
		union
		select
		 d.filed_id as filedId,
		 d.filed_name as filedName,
		 e.filed_show_where as filedShowWhere,
		 e.filed_abc_name as filedAbcName,
		 e.filed_form_type as filedFormType,
		 e.sort_no as sortNo,
		 d.max_length as maxLength,
		 d.filed_alert as filedAlert,
		 d.sort_no as sortNum,
		 d.is_show as isShow
		from bank_pr_filed_type d 
		left join bank_pr_rights_filed e on d.filed_id=e.filed_id
		 
		where d.type_id=#{typeId,jdbcType=VARCHAR} ) t
		order by sortNo
	</select>
</mapper>