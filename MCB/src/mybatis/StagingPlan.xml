<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="com.app.mapper.StagingPlanMapper">
		<resultMap type="stagingPlan" id="StagingPlanResultMap">
			<id column="ID" property="planId"></id>
			<result column="STAGING_PLAN_CODE" property="stagingPlanCode"></result>
			<result column="STAGING_PLAN_NAME" property="stagingPlanName"></result>
			<result column="STATE_CODE" property="stateCode"></result>
			<result column="STAGING_PLAN_RATE" property="stagingPlanRate"></result>
			<result column="HOLD1" property="hold1"></result>
		<association property="state" column="STATE_CODE" javaType="State">
			<id column="STATE_CODE" property="stateCode"/>
			<result column="STATE_NAME" property="stateName"/>
		</association>
		</resultMap>
		<resultMap type="com.app.entity.State" id="StateResultMap">
			<result column="STATE_CODE" property="stateCode"></result>
			<result column="STATE_NAME" property="stateName"></result>
		</resultMap>
		 <sql id="stagingPlanColumns">STAGING_PLAN_CODE,STAGING_PLAN_NAME,STATE_CODE,HOLD1,STAGING_PLAN_RATE</sql>
		
		<select id="stagingPlanPageList" parameterType="com.app.entity.StagingPlan" resultMap="StagingPlanResultMap">
	           SELECT bsp.id,bsp.staging_plan_code,bsp.staging_plan_name,bsp.staging_plan_rate,bs.state_name
       		FROM bank_staging_plan bsp LEFT JOIN bank_state bs
       		ON bsp.state_code = bs.state_code
       		 <if test="stagingPlanName!=null and stagingPlanName!=''">
			and bsp.staging_plan_name like "%"#{stagingPlanName}"%"
			</if>
		</select>
		  
		<select id="notStagingPlanPageList" parameterType="com.app.entity.StagingPlan" resultMap="StagingPlanResultMap">
	        SELECT bsp.id,bsp.staging_plan_code,bsp.staging_plan_name,bsp.staging_plan_rate,bs.state_name
       		FROM bank_staging_plan bsp LEFT JOIN bank_state bs
       		ON bsp.state_code = bs.state_code
       		 <if test="stagingPlanName!=null and stagingPlanName!=''">
			and bsp.staging_plan_name like "%"#{stagingPlanName}"%"
			</if>
		</select>
		<select id="getCountNot" parameterType="stagingPlan" resultType="int">
			SELECT COUNT(1) FROM bank_staging_plan bsp
			<if test="stagingPlanName!=null and stagingPlanName!=''">
			and STAGING_PLAN_NAME like "%"#{stagingPlanName}"%"
			</if>
		</select>
		<!-- 初始化状态数据 -->
			<select id="stateList" resultMap="StateResultMap">
				select STATE_CODE,STATE_NAME from bank_state where 1=1
			</select>
		<!-- 判断是否唯一 -->
		<select id="getCountNewNo" parameterType="stagingPlan" resultType="Integer">
			select count(ID) from bank_staging_plan where STAGING_PLAN_CODE=#{stagingPlanCode}
		</select>
		<insert id="insertstagingPlanSave" parameterType="stagingPlan"  useGeneratedKeys="false" keyProperty="planId">
			insert into bank_staging_plan(<include refid="stagingPlanColumns"/>) 
			values(#{stagingPlanCode},#{stagingPlanName},#{stateCode},#{hold1},#{stagingPlanRate})
		</insert>
		<!-- 查询单条数据 -->
		<select id="stagingPalnById" resultMap="StagingPlanResultMap" parameterType="int">
		 	select * from bank_staging_plan where ID=#{planId}
		</select>
		<update id="stagingPlanEdit" parameterType="stagingPlan">
			update bank_staging_plan set  STAGING_PLAN_NAME=#{stagingPlanName},STAGING_PLAN_RATE=#{stagingPlanRate} where ID=#{planId}
		</update>
		<delete id="stagingPlanDel" parameterType="int">
			delete from bank_staging_plan where ID=#{planId}
		</delete>
				<!-- 删除的时候判断是此数据是否有关联 -->
		<select id="getCountCode" parameterType="Integer" resultType="Integer">
			select count(1) from bank_staging_plan where STATE_CODE=#{stateCode}
		</select>
		
		<select id="selectStagingPlanByCode" parameterType="StagingPlan" resultType="int">
			select count(1) from bank_staging_plan where staging_plan_code=#{stagingPlanCode}
		</select>
		
		</mapper>