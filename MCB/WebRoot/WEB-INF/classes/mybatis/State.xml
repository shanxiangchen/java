<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="com.app.mapper.StateMapper">
		<resultMap type="State" id="StateResultMap">
			<id column="ID" property="stateId"></id>
			<result column="STATE_CODE" property="stateCode"></result>
			<result column="STATE_NAME" property="stateName"></result>
			<result column="STAG_CODE" property="stagCode"></result>
			<association property="stagingType" column="STAG_CODE" javaType="StagingType">
			<id column="STAG_CODE" property="stagCode"/>
			<result column="STAG_NAME" property="stagName"/>
		</association>
		</resultMap>
		<sql id="stateColumns">STATE_CODE,STATE_NAME,STAG_CODE</sql>
		<resultMap type="com.app.entity.StagingType" id="StagingTypeResultMap">
			<result column="STAG_CODE" property="stagCode"></result>
			<result column="STAG_NAME" property="stagName"></result>
		</resultMap>
		<select id="statePageList" parameterType="State" resultMap="StateResultMap">
		   SELECT bs.id,bs.state_code,bs.state_name,bst.stag_name
       		FROM bank_state bs LEFT JOIN bank_staging_type bst
       		ON bs.stag_code = bst.stag_code where 1=1
			<if test="stateName!=null and stateName!=''">
			and bs.STATE_NAME like concat('%',#{stateName},'%')
			</if>
		</select>
		 
		<!-- 初始化分期类型 -->
		<select id="listStagingType" resultMap="StagingTypeResultMap">
			select STAG_CODE,STAG_NAME from bank_staging_type where 1=1
		</select>
		<!-- 判断是否唯一 -->
		<select id="getCountNewNo" parameterType="State" resultType="Integer">
			select count(ID) from bank_state where STATE_CODE=#{stateCode}
		</select>
		<insert id="stateSave" parameterType="State"  useGeneratedKeys="false" keyProperty="StateId">
			insert into bank_state(<include refid="stateColumns"/>) 
			values(#{stateCode},#{stateName},#{stagCode})
		</insert>
		<!-- 查询状态单条数据 -->
		<select id="stateById" parameterType="int" resultMap="StateResultMap">
			select * from bank_state where 1=1 and ID=#{StateId}
		</select>
		<update id="stateEdit" parameterType="State">
			update bank_state set STATE_NAME=#{stateName} where ID=#{stateId}
		</update>
		<delete id="stateDel" parameterType="int">
			delete from bank_state where ID=#{stateId}
		</delete>
				<!-- 删除的时候判断是此数据是否有关联 -->
		<select id="getCountCode" parameterType="String" resultType="int">
			select count(1) from bank_state where STAG_CODE=#{stagCode}
		</select>
	</mapper>