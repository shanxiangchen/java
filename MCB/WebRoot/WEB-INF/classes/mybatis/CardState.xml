<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.mapper.CardStateMapper">
	<resultMap type="CardState" id="CardStateResultMap">
		<id column="CARD_ST_ID" property="cardStId"/>
		<result column="CARD_CONSUMER_PWD" property="cardConsumerPwd"/>
		<result column="CARD_MSG_NOTICE" property="cardMsgNotice"/>
		<result column="CARD_SEND_MODE" property="cardSendMode"/>
		<result column="CARD_SEND_ADDRESS" property="cardSendAddRess"/>
		<result column="CUST_ID" property="custId"/>
		<result column="CARD_INFO_ID" property="cardInfoId"/>
		<result column="CUST_NAME" property="custName"/>
		<result column="card_apply_date" property="cardApplyDate"/>
		
		<association property="inforMation" column="CARD_ST_ID" javaType="InforMation">
			<id column="CUST_ID" property="custId"/>
			<result column="CUST_NAME" property="custName"/>
		</association>
		<association property="cardInfo" column="CARD_ID" javaType="CardInfo">
			<id column="CARD_ID" property="cardId"/>
			<result column="CARD_NAME" property="cardNmae"/>
		</association>
	</resultMap>
	
	<select id="cardStatePageList" parameterType="CardState" resultMap="CardStateResultMap">   
     SELECT bcs.card_st_id,bct.cust_name ,bci.card_name,bcs.card_consumer_pwd,
            bcs.card_msg_notice,bcs.card_send_mode,bcs.card_send_address,bcs.card_apply_date
	          FROM  bank_card_state bcs
	          LEFT JOIN  bank_cust_info bct 
	            ON bcs.cust_id = bct.cust_id LEFT JOIN bank_card_info bci
              ON bcs.card_info_id=bci.card_id  where 1=1
			<if test="custName!=null and custName!=''">
	            and bct.cust_name like "%"#{custName}"%"
	            </if>  
	</select>
	<select id="selectFtpPageList" parameterType="com.app.entity.BankUploadFtp" resultType="com.app.entity.BankUploadFtp">
	    select  
		  t.ftp_id as ftpId,
		  t.cust_name as custName,
		  t.card_num as cardNum,
		  t.cust_phone as custPhone,
		  t.card_consumer_pwd as cardConsumerPwd,
		  t.auto_stages as autoStages,
		  t.auto_stages_money as autoStagesMoney,
		  t.auto_stages_num as autoStagesNum,
		  t.card_name as cardName,
		  t.card_type as cardType,
		  t.main_card_page as mainCardPage,
		  t.unit_num as unitNum,
		  t.bar_code_number as barCodeNumber,
		  t.business_source as businessSource,
		  DATE_FORMAT(t.insert_sys_date,'%Y-%m-%d') as insertSysDate,
		  t.cust_card_id as custCardId,
		  t.card_id as cardId
		from bank_upload_ftp t where 1=1
		<if test="insertSysDate!=null and insertSysDate!=''">
           and DATE_FORMAT(t.insert_sys_date,'%Y-%m-%d')=#{insertSysDate,jdbcType=VARCHAR}
        </if>  
	</select>
	 
	<select id="selectBankUploadFtpList" parameterType="String" resultType="com.app.entity.BankUploadFtp">
	    select  
		  t.ftp_id as ftpId,
		  t.cust_name as custName,
		  t.card_num as cardNum,
		  t.cust_phone as custPhone,
		  ifnull(t.card_consumer_pwd,'0') as cardConsumerPwd,
		  t.auto_stages as autoStages,
		  t.auto_stages_money as autoStagesMoney,
		  t.auto_stages_num as autoStagesNum,
		  t.card_name as cardName,
		  t.card_type as cardType,
		  t.main_card_page as mainCardPage,
		  t.unit_num as unitNum,
		  t.bar_code_number as barCodeNumber,
		  t.business_source as businessSource,
		  t.insert_sys_date as insertSysDate,
		  t.card_id as cardId
		from bank_upload_ftp t where DATE_FORMAT(t.insert_sys_date,'%Y-%m-%d')=#{insertSysDate,jdbcType=VARCHAR}
	</select>
</mapper>